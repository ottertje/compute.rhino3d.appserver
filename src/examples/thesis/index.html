<!doctype html>
<head>
	<title>Threebox Object3D Example</title>
	<link href="https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.css" rel="stylesheet">
	<script src="https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.js"></script>
	<script src="https://kit.fontawesome.com/4b890d1e63.js" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
	<script src="./threebox.js" type="text/javascript"></script>
	<link href="./threebox.css" rel="stylesheet" />
</head>
<body>
	<div id="loader"></div> 
	<div id="container">
		<div id ="sidebar">
			<button id="fly-to-BK-building">fly to BK building  <i class="fa-solid fa-plane"></i></button>

			<div class="addcontainer">
				<div class="titlebox">
					<span class="title-line">- Choose weather EPW & 3D City LOD</span>
				</div>
				<button id="EPW-map">Link to EPW Map  <i class="fa-solid fa-earth-americas"></i></button>
				<div id="popup" class="popup">
					<div class="popup-content">
					  <span class="close" id="closePopup">&times;</span>
					  <p>You should click a place on the map, right-click, and then select "Copy Link Address".</p>
					  <a href="https://www.ladybug.tools/epwmap/" target="_blank">Open EPW Map</a>
					  <div class="input-column">
						<label for="userInput">Your Input:</label>
						<i class="fa-solid fa-link"></i><input type="text" id="userInput">
						<button id="okButton">OK <i class="fa-regular fa-circle-check"></i></button>
					  </div>
					</div>
				</div>
				<div class="slidecontainer">
					<form class="lod-form">
						<label class="LOD-level-title">Choose surroundings LOD:</label>
						<label class="LOD-level">
							<input type="radio" name="LODLevel" value="1" > LOD1.3
						</label>
						<label class="LOD-level">
						  <input type="radio" name="LODLevel" value="2" checked> LOD2.2
						</label>
					</form>					  
				</div>
			</div>

			<p></p>
			<div class="addcontainer">
				<div class="titlebox">
					<span class="title-line">- Add surrounding buildings</span>
				</div>
				<div class="dropdownbuilding">
					<button id="add-building">Add new buildings <i class="fa-regular fa-building"></i></button>  
					<div class="dropdownbuilding-content">
						<a id="add-one"><img class="option-img" src="./1.jpg"> Type 1</a>
						<a id="add-two"><img class="option-img" src="./2.jpg"> Type 2</a>
						<a id="add-three"><img class="option-img" src="./3.jpg"> Type 3</a>
					</div>
				</div>
				<div class="instructionbox">
					<span class="instruction-line">unit: meter(m)</span>
				</div>
				<div class="slidecontainer">
					<div style="position: relative;">
						<input type="range" id="depth" name="depth" min="4" max="25" value="25" step="1" onchange="updateSliderValue('depthCurrentValue', this.value, this)">
						<label class="tagname">Depth</label>
						<br>
						<span class="slider-min">4</span> 
						<span class="slider-value" id="depthCurrentValue" style="left: calc(70% * 25 / 25);">Current: 25</span> 
						<span class="slider-max">25</span> 
					</div>
					<div style="position: relative;">
						<input type="range" id="width" name="width" min="4" max="70" value="25" step="1" onchange="updateSliderValue('widthCurrentValue', this.value, this)">
						<label class="tagname">Height</label>
						<br>
						<span class="slider-min">4</span> 
						<span class="slider-value" id="widthCurrentValue" style="left: calc(70% * 25 / 70);">Current: 25</span> 
						<span class="slider-max">70</span> 
					</div>
					<div style="position: relative;">
						<input type="range" id="height" name="height" min="4" max="50" value="25" step="1" onchange="updateSliderValue('heightCurrentValue', this.value, this)">
						<label class="tagname">Width</label>
						<br>
						<span class="slider-min">4</span>
						<span class="slider-value" id="heightCurrentValue" style="left: calc(70% * 25 / 50);">Current: 25</span> 
						<span class="slider-max">50</span> 
					</div>
					<p></p>
				</div>
				<p></p>
				<button id="apply-apply">Apply  <i class="fa-regular fa-circle-check"></i></button>
				<div class="input-container">
					<button id="remove-layer">Clean all added buildings  <i class="fa-regular fa-trash-can"></i></button>
				</div>
				<div class="button-container">
					<button id="select-delete">Delete selected  <i class="fa-regular fa-rectangle-xmark"></i></button>
				</div>
			</div> 


			<p></p>
			<div class="addcontainer">
				<div class="titlebox">
					<span class="title-line">- Choose added builing material</span>
				</div>
				<div class="dropdown">
					<button id="compute-rhino">Choose material (Default: Brick)  <i class="fa-regular fa-hand-pointer"></i></button>
						<div class="dropdown-content">
							<a id="material-1">Brick <label class="eye-level"> (ρd:50%)</label></a>
							<a id="material-2">Float Glass <label class="eye-level"> (ρd:3%, Td:85%, Ts:10%, S:2%)</label></a>
							<a id="material-3">Reflective Glass <label class="eye-level"> (ρd:10%, Td:40%, Ts:10%, S:30%)</label></a>
						</div>
					<div id="material-result"></div>
				</div>
			</div>


			<p></p>
			<div class="addcontainer">
				<div class="titlebox">
					<span class="title-line">- Select room by name</span>

				</div>

				<div class="input-container">
					<input list="roomNumbersList" id="roomChoice" name="roomChoice" placeholder="--- Query Room Name ---"/>
					<datalist id="roomNumbersList">
						<option style="display:none;" selected>Select language</option>
						<option value="">All</option> <!-- Default option -->
					</datalist>
				</div>
				<div class="button-container">
					<button id="room-preview">Room Preview  <i class="fa-solid fa-magnifying-glass"></i></button>
				</div>
				<div class="instructionbox">
					<span class="instruction-line">Select room or query by name. (Example: 01.Oost.330)</span>
				</div>
			</div>


			<p></p>
			<div class="addcontainer">
				<div class="titlebox">
					<span class="title-line">- Choose daylight metrics</span>
				</div>
				<div class="dropdown">
					<button id="compute-rhino">Compute  <i class="fa-regular fa-share-from-square"></i></button>
					<div class="dropdown-content">
						<a id="option-1">Daylight Autonomy (DA)</a>
						<a id="option-2">Spacial Daylight Autonomy (sDA)</a>
						<a id="option-3">Useful Daylight Illuminance (UDI)</a>
						<a id="option-4">Sunlight Beam Index (SBI)</a>
					</div>
				</div>
				<div class="slidecontainer">
					<form>
						<label class="eye-level">
							<input type="radio" name="eyeLevel" value="0.8" checked>Desk Surface Level (0.8m)
						</label>
						<label class="eye-level">
						  	<input type="radio" name="eyeLevel" value="1.2">Seated Eye Level (1.2m)
						</label>
					</form>					  
				</div>	
			</div>
			

			<p></p>
			<div class="addcontainer">
				<div class="titlebox">
					<span class="title-line">- Result</span>
				</div>
				<div id="pictureContainer">
					<!-- Placeholder for the picture -->
				</div>
				<p class="show-text" id="resultMessage"> </p>
				<p></p>
			</div>
			

			<p></p>
			<div class="addcontainer">
				<div class="titlebox">
					<span class="title-line">- Result Comparison</span>
				</div>
				<p class="show-text" id="compareMessage"> </p>
				<p></p>
			</div>

			<p></p>



		</div>
		<div id='mapID'>
			<div class="mapboxgl-ctrl helpDiv">
				<div id="help" class="help">
					<!-- This demo shows camera alignment between fill-extrusion layer and a 3DObject -->
					<p><kbd>Shift</kbd> + left click to <i class="fa-regular fa-hand"></i> Drag & Move</p>
					<p><kbd>Alt</kbd> + left click to <i class="fa-solid fa-rotate-right"></i> Rotate </p>
				</div>
			</div>
		</div>


	</div>

	<script async src="https://unpkg.com/es-module-shims@1.8.0/dist/es-module-shims.js"></script>

	<script type="importmap">
		{
		  "imports": {
			"three": "https://unpkg.com/three@0.158.0/build/three.module.js",
			"three/examples/jsm/loaders/3DMLoader": "https://unpkg.com/three@0.158.0/examples/jsm/loaders/3DMLoader.js",
			"rhino3dm":"https://unpkg.com/rhino3dm@8.0.0-beta3/rhino3dm.module.js"
		  }
		}
	</script>

	<script>
		function updateSliderValue(id, value, slider) {
			var currentValueSpan = document.getElementById(id);
			currentValueSpan.textContent = "Current: " + value;
			currentValueSpan.style.left = "calc(70% * " + value + " / " + slider.max + ")";
		}
	</script>

	<script type="module" src="./script.js"></script>
	</script>
</body>